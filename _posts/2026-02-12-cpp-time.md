---
title: c++ 시간 측정
date: 2026-02-12 21:22:34 +0900
categories: [C++, 시간측정]
tags: [c++, time]
description: c++ 시간 측정
---

## GetTickCount()

GetTickCount는 Windows API 함수이다.
시스템이 시작된 후 경과된 시간(최대 49.7일)을 반환한다.

- 반환타입 : DWORD
- 단위: 밀리초(ms)
- 해상도: 15.625ms
- 주의: 
  - 시간의 최대 해상도가 15.625ms 이다. 더 높은 해상도로는 측정할 수 없다. 그래서 정밀한 시간이 필요한 로직에는 사용할 수 없다. timeBeginPeriod( 1 ); 함수를 호출하더라도 최대 해상도는 15.625ms 이다.
  - 시스템이 시작된 지 최대 49.7일 까지만 유효하다.

```cpp
    DWORD tick = GetTickCount();
00007FF79D681940  call        qword ptr [__imp_GetTickCount (07FF79D683008h)]  // 함수 호출이 발생하기는 한다.

// GetTickCount 함수 내부
00007FF9D62C8600  mov         ecx,7FFE0320h              // 7FFE0320h 값을 rcx에 넣는다.
00007FF9D62C8605  mov         rcx,qword ptr [rcx]        // rcx 주소 위치의 값을 rcx에 넣는다.       이 때 rcx는 0x00000000004ddcd9
00007FF9D62C8608  mov         eax,dword ptr [7FFE0004h]  // 7FFE0004h 주소 위치의 값을 rax에 넣는다. 이 때 rax는 0x000000000fa00000
00007FF9D62C860F  imul        rax,rcx                    // rax와 rcx를 곱한다음 rax에 저장한다.     이 때 rax는 0x0004c09abea00000
00007FF9D62C8613  shr         rax,18h                    // rax를 24비트 오른쪽으로 민다.            이 때 rax는 0x0000000004c09abe
00007FF9D62C8617  ret                                    // return
```
어셈블리 명령어 몇 개로 시간값을 얻어온다.  
정해진 특정 주소(7FFE0320h, 7FFE0004h)에서 단순히 값을 가져와서 시간을 계산한다.  
그래서 속도가 매우 빠르다.  


## GetTickCount64()

GetTickCount64는 Windows API 함수이다.
시스템이 시작된 후 경과된 시간을 반환한다. ULONGLONG 타입이기 때문에 시스템이 아무리 오래 켜져있어도 괜찮음.

- 반환타입 : ULONGLONG
- 단위: 밀리초(ms)
- 해상도: 15.625ms
- 주의: 
  - 시간의 최대 해상도가 15.625ms 이다. 더 높은 해상도로는 측정할 수 없다. 그래서 정밀한 시간이 필요한 로직에는 사용할 수 없다. timeBeginPeriod( 1 ); 함수를 호출하더라도 최대 해상도는 15.625ms 이다.

```cpp
    ULONGLONG tick = GetTickCount64();
00007FF6F2FB1940  call        qword ptr [__imp_GetTickCount64 (07FF6F2FB3008h)]  // 함수 호출

// GetTickCount64 함수 내부
00007FF9D62C2B00  mov         ecx,dword ptr [7FFE0004h]  
00007FF9D62C2B07  mov         eax,7FFE0320h  
00007FF9D62C2B0C  shl         rcx,20h  
00007FF9D62C2B10  mov         rax,qword ptr [rax]  
00007FF9D62C2B13  shl         rax,8  
00007FF9D62C2B17  mul         rax,rcx  
00007FF9D62C2B1A  mov         rax,rdx  
00007FF9D62C2B1D  ret  
```

GetTickCount 함수와 마찬가지로 어셈블리 명령어 몇 개로 시간값을 얻어온다.  
정해진 특정 주소(7FFE0320h, 7FFE0004h)에서 단순히 값을 가져와서 시간을 계산한다.  
그래서 속도가 매우 빠르다.  


## timeGetTime()

timeGetTime은 Windows API 함수이다.
시스템이 시작된 후 경과된 시간을 반환한다. DWORD 타입이기 때문에 최대값(49.71일) 주의 필요
이 함수를 사용하려면 Winmm.lib 라이브러리 필요함. #pragma comment(lib, "Winmm.lib")

- 반환타입 : DWORD
- 단위: 밀리초(ms)
- 해상도 : timeBeginPeriod( 1 ) 를 호출하면 1ms 까지 가능하다.

```cpp
    DWORD tick = timeGetTime();
```

내부적으로 kernel32.dll!ReadInterruptTick(void) 함수를 호출해서 시간삾을 가져온다.  
그래서 GetTickCount 보다 느리다.

## __rdtsc()

__rdtsc() 는 컴파일러 내장 함수(Intrinsic Function) 이다.  
컴파일러 내장 함수는 컴파일할 때 어셈블리 명령어로 직접 변환된다.  
__rdtsc() 함수는 rdtsc(Read Timestamp Counter) 어셈블리 명령어로 변환된다.  
__rdtsc() 는 CPU 내부의 타임스탬프 카운터(Timestamp Counter, TSC) 값을 직접 읽어온다. 이 값은 지금까지 실행된 CPU 사이클 수이다.

- 반환타입 : unsigned __int64
- 단위: 밀리초(ms)
- 해상도: 1 CPU 사이클
- 주의: 이 명령어로 얻은 값을 실제로 시간 측정에는 사용하기 힘들다. 왜냐하면 CPU가 1초동안 돌리는 사이클 수가 항상 일정하지는 않기 때문이다.

```cpp
    unsigned __int64 tick = __rdtsc();
#ifdef THIS_IS_COMMENT
00007FF75CD71018  rdtsc                              // 이 명령어가 수행되면 rax, rdx 레지스터에 CPU 사이클 수 값이 들어온다.
00007FF75CD7101A  shl         rdx,20h
00007FF75CD7101E  or          rax,rdx                // rax 와 rdx 값을 OR 연산으로 합친다.
00007FF75CD71021  mov         qword ptr [sc],rax
```

rdtsc 명령어는 약 20~40 CPU 사이클이 소요된다고 한다.  


## QueryPerformanceCounter()

QueryPerformanceCounter 함수는 Windows API 함수이다.  
함수 내부에서 rdtscp 명령어로 타임스탬프 카운터(Time Stamp Counter, TSC) 값을 얻어 사용한다. 그래서 시간 해상도가 매우 높다.  
rdtscp 명령어로 얻은 값을 적절히 가공하여 보기 편한 형태로 제공해준다.  
최대 1/10,000,000초(100 nanoseconds) 단위로 시간을 측정해준다.  

- 반환타입 : LARGE_INTEGER
- 단위: 100 나노초(us)
- 해상도: 1/10,000,000초(100 nanoseconds)

```cpp
int main()
{
    timeBeginPeriod(1);

    // 먼저 시간 해상도를 얻는다.
    LARGE_INTEGER freq;
    QueryPerformanceFrequency(&freq);

    while (true)
    {
        // 시작시간 기록
        LARGE_INTEGER start;
        QueryPerformanceCounter(&start);

        // 로직
        std::this_thread::sleep_for(std::chrono::milliseconds(100));

        // 종료시간 기록
        LARGE_INTEGER end;
        QueryPerformanceCounter(&end);

        // 걸린시간을 밀리초 단위로 출력
        double duration = static_cast<double>(end.QuadPart - start.QuadPart) / static_cast<double>(freq.QuadPart / 1000 );
        std::cout << duration << std::endl;
    }

    return 0;
}
```


## std::chrono::steady_clock::now()

std::chrono::steady_clock::now() Windows 환경에서는 내부적으로 QueryPerformanceCounter를 사용한다.  
함수 내부에서 rdtscp 명령어로 타임스탬프 카운터(Time Stamp Counter, TSC) 값을 얻어 사용하기 때문에 시간 해상도가 매우 높다.  
rdtscp 명령어로 얻은 값을 적절히 가공하여 보기 편한 형태로 제공해준다.  
최대 1/10,000,000초(100 nanoseconds) 단위로 시간을 측정해준다.  

- 반환타입 : std::chrono::steady_clock::time_point
- 단위: 100 나노초(us)
- 해상도: 1/10,000,000초(100 nanoseconds)
  
```cpp
int main()
{
    while (true)
    {
        // 시작시간
        auto start = std::chrono::steady_clock::now();

        // 로직
        std::this_thread::sleep_for(std::chrono::milliseconds(100));

        // 종료시간
        auto end = std::chrono::steady_clock::now();

        // 걸린시간을 밀리초 단위로 변환, 출력
        __int64 duration = std::chrono::duration_cast<std::chrono::milliseconds>(end - start).count();
        std::cout << duration << std::endl;
    }

    return 0;
}
```


## std::chrono::high_resolution_clock::now()

std::chrono::high_resolution_clock 은 std::chrono::steady_clock 의 별칭이다.  
그래서 그냥 std::chrono::steady_clock 을 사용하면 된다.


## std::chrono::system_clock::now()

std::chrono::system_clock::now() 함수는 Windows에서 내부적으로 GetSystemTimePreciseAsFileTime() 함수를 호출한다.  
GetSystemTimePreciseAsFileTime() 함수는 FILETIME 구조체를 전달받고, 여기에 시스템의 현재시간을 입력해준다.  

- 반환타입 : std::chrono::system_clock::time_point
- 단위: 100 나노초(us)
- 해상도: 1/10,000,000초(100 nanoseconds)
- 주의: 시스템의 현재 시간이기 때문에 컴퓨터의 시간을 변경하면 system_clock의 값도 변경된다. 그래서 이 함수는 걸린시간 측정 용도로는 적합하지 않다. 대신 로그를 찍기 위해 현재시간을 얻는 등의 용도로는 적합하다.

```cpp
int main()
{
    while (true)
    {
        // 현재시간
        auto now = std::chrono::system_clock::now();

        // 현재시간을 출력
        std::cout << std::format("{:%F %T}", now) << std::endl;
    }

    return 0;
}
```
